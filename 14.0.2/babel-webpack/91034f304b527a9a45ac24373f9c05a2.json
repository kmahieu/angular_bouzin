{"ast":null,"code":"import _asyncToGenerator from \"/root/bouzin/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\n/* It's a service that manages the offers */\nimport { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject, lastValueFrom, map } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"src/app/auth/services/tokens.service\";\nexport class OfferService {\n  constructor(httpClient, tokensService) {\n    this.httpClient = httpClient;\n    this.tokensService = tokensService;\n    this.offers = [];\n    /* It's creating a new BehaviorSubject object, which is a type of Subject. A Subject is an object\n    that\n    can emit values to its subscribers. A BehaviorSubject is a Subject that emits the last value it\n    received\n    to its subscribers. */\n\n    this.observableOffer = new BehaviorSubject(this.offers);\n    this.API_URL = 'https://api.emploi-store.fr/partenaire/offresdemploi/v2/offres/search';\n    console.log('OfferService created');\n    this.getObservableOffers();\n  }\n\n  getObservableOffers() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const token = yield lastValueFrom(_this.tokensService.getToken());\n      console.log(token);\n      return lastValueFrom(_this.httpClient.get(_this.API_URL, {\n        headers: new HttpHeaders({\n          'Authorization': 'Bearer ' + token\n        })\n      }).pipe(map(data => {\n        let list = [];\n        data.resultats.forEach(e => {\n          list.push({\n            designation: e.intitule\n          });\n        });\n        return list;\n      })));\n    })();\n  }\n\n  getRandomInt() {\n    return Math.floor(Math.random() * 10000000000000000000).toString();\n  } // getObservableOffers(): Observable<Offer[]> {\n  //   return this.observableOffer.asObservable();\n  // }\n\n\n  getObservableOffer(id) {\n    return this.observableOffer.asObservable().pipe(map(offers => offers.find(offer => offer.id === id)));\n  }\n\n  getSubjectOffer() {\n    return this.observableOffer;\n  }\n\n  addOffer(offer) {\n    this.observableOffer.getValue().push(offer);\n    this.getSubjectOffer().next(this.observableOffer.getValue());\n  }\n\n  updateOffer(offer) {\n    this.getSubjectOffer().next(offer);\n  }\n\n  selecteOffer(offer) {\n    this.selectedOffer = offer;\n  }\n\n  blacklistedUnBlacklisteOffer(offer) {\n    this.observableOffer.getValue().find(o => {\n      if (o.id === offer.id) {\n        o.isBlacklisted = !o.isBlacklisted;\n        console.log(o);\n      }\n\n      this.observableOffer.next(this.observableOffer.getValue());\n    });\n  }\n\n  favoriteUnFavoriteOffer(offer) {\n    this.observableOffer.getValue().find(o => {\n      if (offer.id === o.id) {\n        o.isFavorite = !o.isFavorite;\n        console.log(o);\n      }\n\n      this.observableOffer.next(this.observableOffer.getValue());\n    });\n  }\n\n  applyOffer(offer) {\n    this.observableOffer.getValue().find(o => {\n      if (offer.id === o.id) {\n        o.isApply = !o.isApply;\n        console.log(o);\n      }\n\n      this.observableOffer.next(this.observableOffer.getValue());\n    });\n  }\n\n  openOffer(offer) {\n    this.observableOffer.getValue().find(o => {\n      if (offer.id === o.id) {\n        o.isOpen = !o.isOpen;\n        console.log(o);\n      }\n\n      this.observableOffer.next(this.observableOffer.getValue());\n    });\n  }\n\n  getBlackLidtOffer() {\n    return this.observableOffer.asObservable().pipe(map(offers => offers.filter(o => o.isBlacklisted)), map(offers => offers.length));\n  }\n\n}\n\nOfferService.ɵfac = function OfferService_Factory(t) {\n  return new (t || OfferService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.TokensService));\n};\n\nOfferService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: OfferService,\n  factory: OfferService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["HttpHeaders","BehaviorSubject","lastValueFrom","map","OfferService","constructor","httpClient","tokensService","offers","console","log","getObservableOffers","token","getToken","get","API_URL","headers","pipe","data","list","resultats","forEach","e","push","designation","intitule","getRandomInt","Math","floor","random","toString","getObservableOffer","id","observableOffer","asObservable","find","offer","getSubjectOffer","addOffer","getValue","next","updateOffer","selecteOffer","selectedOffer","blacklistedUnBlacklisteOffer","o","isBlacklisted","favoriteUnFavoriteOffer","isFavorite","applyOffer","isApply","openOffer","isOpen","getBlackLidtOffer","filter","length","i0","factory","providedIn"],"sourceRoot":"","sources":["/root/bouzin/src/app/buisness/offer/services/offer.service.ts"],"sourcesContent":["/* It's a service that manages the offers */\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { BehaviorSubject, lastValueFrom, map, Observable, Subject } from 'rxjs';\nimport { TokensService } from 'src/app/auth/services/tokens.service';\nimport { ApiOffer } from '../models/apiOffer';\nimport { Data } from '../models/data';\nimport { Offer } from '../models/offer';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OfferService {\n\n  selectedOffer?: Offer;\n\n  offers: Offer[] = [];\n\n  /* It's creating a new BehaviorSubject object, which is a type of Subject. A Subject is an object\n  that\n  can emit values to its subscribers. A BehaviorSubject is a Subject that emits the last value it\n  received\n  to its subscribers. */\n  private observableOffer = new BehaviorSubject<Offer[]>(this.offers);\n\n  private API_URL = 'https://api.emploi-store.fr/partenaire/offresdemploi/v2/offres/search'\n\n  constructor(\n    private httpClient: HttpClient,\n    private tokensService: TokensService,\n  ) {\n    console.log('OfferService created');\n    this.getObservableOffers()\n  }\n\n  async getObservableOffers(): Promise<Offer[]> {\n\n    const token = await lastValueFrom(this.tokensService.getToken());\n    console.log(token);\n\n      return lastValueFrom(this.httpClient.get<Offer[]>(this.API_URL , {\n        headers : new HttpHeaders({\n          'Authorization' : 'Bearer ' + token\n        })\n      })\n        .pipe(\n          map( (data: any) => {\n            let list = [] as Offer[];\n            data.resultats.forEach((e: any) => {\n              list.push({\n                designation : e.intitule\n              } as Offer)\n            })\n            return list as Offer[];\n          })\n        ))\n      ;\n\n  }\n\n  getRandomInt(): String {\n    return Math.floor(Math.random() * 10000000000000000000).toString();\n  }\n\n  // getObservableOffers(): Observable<Offer[]> {\n  //   return this.observableOffer.asObservable();\n  // }\n\n  getObservableOffer(id: string): Observable<Offer | undefined> {\n    return this.observableOffer.asObservable()\n      .pipe(\n        map(offers => offers.find(offer => offer.id === id))\n      );\n  }\n\n  getSubjectOffer(): Subject<Offer[]> {\n    return this.observableOffer;\n  }\n\n  addOffer(offer: Offer): void {\n    this.observableOffer.getValue().push(offer);\n    this.getSubjectOffer().next(this.observableOffer.getValue());\n  }\n\n  updateOffer(offer: Offer[]): void {\n    this.getSubjectOffer().next(offer);\n  }\n\n  selecteOffer(offer: Offer): void {\n    this.selectedOffer = offer;\n  }\n\n  blacklistedUnBlacklisteOffer(offer: Offer): void {\n    this.observableOffer.getValue().find(o => {\n      if (o.id === offer.id) {\n        o.isBlacklisted = !o.isBlacklisted;\n        console.log(o)\n      }\n      this.observableOffer.next(this.observableOffer.getValue());\n    })}\n\n  favoriteUnFavoriteOffer(offer: Offer): void {\n      this.observableOffer.getValue().find(o => {\n        if (offer.id === o.id) {\n          o.isFavorite = !o.isFavorite;\n          console.log(o)\n        }\n        this.observableOffer.next(this.observableOffer.getValue());\n    })\n  }\n\n  applyOffer(offer: Offer): void {\n    this.observableOffer.getValue().find(o => {\n      if (offer.id === o.id) {\n        o.isApply = !o.isApply;\n        console.log(o)\n      }\n      this.observableOffer.next(this.observableOffer.getValue());\n  })\n  }\n\n  openOffer(offer: Offer): void {\n    this.observableOffer.getValue().find(o => {\n      if (offer.id === o.id) {\n        o.isOpen = !o.isOpen;\n        console.log(o)\n      }\n      this.observableOffer.next(this.observableOffer.getValue());\n    })}\n\n  getBlackLidtOffer(): Observable<number> {\n    return this.observableOffer.asObservable()\n      .pipe(\n        map(offers => offers.filter(o => o.isBlacklisted)),\n        map(offers => offers.length)\n    );\n  }\n\n}\n"]},"metadata":{},"sourceType":"module"}